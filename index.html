<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>室內設計工作室收支管理 (Demo)</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter Font (optional, but good for aesthetics) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        /* Custom animation for modals */
        @keyframes scale-in {
            from {
                transform: scale(0.95);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }
        .animate-scale-in {
            animation: scale-in 0.3s ease-out forwards;
        }
        /* Ensure responsive containers for charts */
        .recharts-responsive-container {
            width: 100% !important;
            height: 300px !important; /* Fixed height for charts */
        }
    </style>

    <!-- React and ReactDOM CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Recharts CDN for charts -->
    <script src="https://unpkg.com/recharts/umd/Recharts.min.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // Global Constants for categories and methods
        const incomeCategories = ['專案收入', '其他收入'];
        const expenseCategories = ['材料費', '施工費', '外包設計費', '運輸費', '水電瓦斯費', '租金', '辦公用品費', '交際費', '雜項支出'];
        const paymentMethods = ['銀行轉帳', '現金', '支票', '信用卡'];
        const projectStatuses = ['規劃中', '施工中', '驗收中', '已結案', '暫停'];
        const COLORS = ['#0088FE', '#00C49F', '#FFBB28', '#FF8042', '#8884d8', '#82ca9d', '#ffc658', '#a4de6c', '#d0ed57', '#83a6ed']; // Colors for charts

        // --- Dummy Data Generation ---
        const generateRandomDate = (start, end) => {
            const date = new Date(start.getTime() + Math.random() * (end.getTime() - start.getTime()));
            return date.toISOString().split('T')[0]; // YYYY-MM-DD
        };

        const generateRandomAmount = (min, max) => {
            return Math.round(Math.random() * (max - min) + min); // Round to nearest integer
        };

        const generateRandomString = (length) => {
            const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            const charactersLength = characters.length;
            for (let i = 0; i < length; i++) {
                result += characters.charAt(Math.floor(Math.random() * charactersLength));
            }
            return result;
        };

        const generateDummyData = () => {
            const projects = [];
            const transactions = [];
            const now = new Date();

            for (let i = 0; i < 12; i++) { // Generate for past 12 months
                const projectDate = new Date(now.getFullYear(), now.getMonth() - i, 1); // First day of the month
                const projectYear = projectDate.getFullYear();
                const projectMonth = projectDate.getMonth(); // 0-11

                const startDate = new Date(projectYear, projectMonth, 1);
                const endDate = new Date(projectYear, projectMonth + 1, 0); // Last day of the month

                const projectId = `proj-${projectYear}-${(projectMonth + 1).toString().padStart(2, '0')}-${generateRandomString(4)}`;
                const projectName = `${projectYear}年${projectMonth + 1}月設計專案 ${generateRandomString(3)}`;
                const clientName = `客戶 ${generateRandomString(4)}`;
                const estimatedRevenue = generateRandomAmount(500000, 1500000);
                // For demo, older projects are likely '已結案'
                const status = i < 6 ? '已結案' : projectStatuses[Math.floor(Math.random() * (projectStatuses.length - 1))]; // Avoid '暫停' for recent
                if (status === '暫停') { // Ensure older projects are '已結案'
                    status = '已結案';
                }


                const project = {
                    id: projectId,
                    projectName,
                    clientName,
                    status,
                    estimatedRevenue: estimatedRevenue,
                    startDate: startDate.toISOString().split('T')[0],
                    endDate: endDate.toISOString().split('T')[0],
                    createdAt: new Date().toISOString()
                };
                projects.push(project);

                // Generate 3 income transactions for this project
                for (let j = 0; j < 3; j++) {
                    const incomeAmount = generateRandomAmount(100000, 500000);
                    const incomeDate = generateRandomDate(startDate, endDate);
                    const incomeCategory = incomeCategories[Math.floor(Math.random() * incomeCategories.length)];
                    const paymentMethod = paymentMethods[Math.floor(Math.random() * paymentMethods.length)];

                    transactions.push({
                        id: `txn-inc-${projectId}-${j}-${generateRandomString(4)}`,
                        projectId: projectId,
                        type: 'income',
                        amount: incomeAmount,
                        date: incomeDate,
                        category: incomeCategory,
                        paymentMethod: paymentMethod,
                        invoiceNumber: `INV-${generateRandomString(8)}`,
                        taxId: '',
                        supplier: clientName,
                        description: `虛擬收入 - ${incomeCategory} ${j + 1}`,
                        createdAt: new Date().toISOString()
                    });
                }

                // Generate 3 expense transactions for this project
                for (let j = 0; j < 3; j++) {
                    const expenseAmount = generateRandomAmount(10000, 100000);
                    const expenseDate = generateRandomDate(startDate, endDate);
                    const expenseCategory = expenseCategories[Math.floor(Math.random() * expenseCategories.length)];
                    const paymentMethod = paymentMethods[Math.floor(Math.random() * paymentMethods.length)];
                    const supplierName = `供應商 ${generateRandomString(4)}`;
                    const taxId = generateRandomString(8);

                    transactions.push({
                        id: `txn-exp-${projectId}-${j}-${generateRandomString(4)}`,
                        projectId: projectId,
                        type: 'expense',
                        amount: expenseAmount,
                        date: expenseDate,
                        category: expenseCategory,
                        paymentMethod: paymentMethod,
                        invoiceNumber: `EXP-${generateRandomString(8)}`,
                        taxId: taxId,
                        supplier: supplierName,
                        description: `虛擬支出 - ${expenseCategory} ${j + 1}`,
                        createdAt: new Date().toISOString()
                    });
                }
            }

            // Calculate actual revenue/expense/net profit for projects based on generated transactions
            const projectsWithActuals = projects.map(project => {
                const projectTransactions = transactions.filter(t => t.projectId === project.id);
                const actualRevenue = projectTransactions
                    .filter(t => t.type === 'income')
                    .reduce((sum, t) => sum + t.amount, 0);
                const actualExpense = projectTransactions
                    .filter(t => t.type === 'expense')
                    .reduce((sum, t) => sum + t.amount, 0);

                return {
                    ...project,
                    actualRevenue,
                    actualExpense,
                    actualNetProfit: actualRevenue - actualExpense
                };
            });

            return { projects: projectsWithActuals, transactions };
        };

        // Generate static dummy data once
        const { projects: staticProjects, transactions: staticTransactions } = generateDummyData();

        // --- Custom Modal Components (replacing alert/confirm) ---
        const Modal = ({ isOpen, onClose, title, children, className = '' }) => {
            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 p-4 animate-scale-in">
                    <div className={`bg-white rounded-xl shadow-2xl w-full max-w-md transform transition-all duration-300 ${className}`}>
                        <div className="px-6 py-4 border-b border-gray-100 flex justify-between items-center">
                            <h3 className="text-xl font-semibold text-gray-800">{title}</h3>
                            <button onClick={onClose} className="text-gray-500 hover:text-gray-700">
                                <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" />
                                </svg>
                            </button>
                        </div>
                        <div className="p-6 text-gray-700">
                            {children}
                        </div>
                    </div>
                </div>
            );
        };

        const AlertDialog = ({ isOpen, onClose, message, title = "提示" }) => {
            return (
                <Modal isOpen={isOpen} onClose={onClose} title={title}>
                    <p className="text-base text-gray-700 mb-4">{message}</p>
                    <div className="flex justify-end">
                        <button
                            onClick={onClose}
                            className="bg-blue-600 text-white px-5 py-2 rounded-lg shadow-md hover:bg-blue-700 transition-colors transform hover:scale-105"
                        >
                            確定
                        </button>
                    </div>
                </Modal>
            );
        };

        const ConfirmationDialog = ({ isOpen, onClose, onConfirm, message, title = "確認" }) => {
            return (
                <Modal isOpen={isOpen} onClose={onClose} title={title}>
                    <p className="text-base text-gray-700 mb-6">{message}</p>
                    <div className="flex justify-end gap-3">
                        <button
                            onClick={() => { onClose(); onConfirm(false); }}
                            className="bg-gray-300 text-gray-800 px-5 py-2 rounded-lg hover:bg-gray-400 transition-colors transform hover:scale-105"
                        >
                            取消
                        </button>
                        <button
                            onClick={() => { onClose(); onConfirm(true); }}
                            className="bg-red-600 text-white px-5 py-2 rounded-lg shadow-md hover:bg-red-700 transition-colors transform hover:scale-105"
                        >
                            確定
                        </button>
                    </div>
                </Modal>
            );
        };

        // --- Error Boundary Component ---
        class ErrorBoundary extends React.Component {
            constructor(props) {
                super(props);
                this.state = { hasError: false, error: null, errorInfo: null };
            }

            static getDerivedStateFromError(error) {
                return { hasError: true, error: error };
            }

            componentDidCatch(error, errorInfo) {
                console.error("Uncaught error:", error, errorInfo);
                this.setState({ errorInfo: errorInfo });
            }

            render() {
                if (this.state.hasError) {
                    return (
                        <div className="flex flex-col items-center justify-center min-h-screen bg-red-50 p-6 rounded-xl shadow-lg text-red-800">
                            <h2 className="text-2xl font-bold mb-4">發生錯誤！</h2>
                            <p className="text-lg mb-4">很抱歉，應用程式發生了預期之外的問題。</p>
                            <details className="w-full max-w-md p-4 bg-red-100 border border-red-300 rounded-lg text-sm text-red-700">
                                <summary className="font-semibold cursor-pointer">點擊查看錯誤詳情</summary>
                                <pre className="mt-2 whitespace-pre-wrap break-all">
                                    {this.state.error && this.state.error.toString()}
                                    <br />
                                    {this.state.errorInfo && this.state.errorInfo.componentStack}
                                </pre>
                            </details>
                            <button
                                onClick={() => window.location.reload()}
                                className="mt-6 bg-blue-600 text-white px-6 py-2.5 rounded-lg shadow-md hover:bg-blue-700 transition-colors transform hover:scale-105"
                            >
                                重新載入應用程式
                            </button>
                        </div>
                    );
                }
                return this.props.children;
            }
        }

        // Main Application Component
        const App = () => {
            // State for custom alert/confirm dialogs
            const [isAlertDialogOpen, setIsAlertDialogOpen] = React.useState(false);
            const [alertDialogMessage, setAlertDialogMessage] = React.useState('');
            const [isConfirmDialogOpen, setIsConfirmDialogOpen] = React.useState(false);
            const [confirmDialogMessage, setConfirmDialogMessage] = React.useState('');
            const confirmCallback = React.useRef(null); // To store the callback for confirmation

            const showAlert = (message) => {
                setAlertDialogMessage(message);
                setIsAlertDialogOpen(true);
            };

            const showConfirm = (message) => {
                return new Promise((resolve) => {
                    setConfirmDialogMessage(message);
                    setIsConfirmDialogOpen(true);
                    confirmCallback.current = resolve;
                });
            };

            // No Firebase initialization needed for static demo
            // No userId or auth state needed

            return (
                <div className="min-h-screen bg-gray-50 font-sans text-gray-800 antialiased">
                    <Header /> {/* No userId prop needed */}
                    <ErrorBoundary> {/* Wrap MainContent with ErrorBoundary */}
                        <MainContent showAlert={showAlert} showConfirm={showConfirm} />
                    </ErrorBoundary>
                    {/* Global Alert and Confirmation Dialogs */}
                    <AlertDialog
                        isOpen={isAlertDialogOpen}
                        onClose={() => setIsAlertDialogOpen(false)}
                        message={alertDialogMessage}
                    />
                    <ConfirmationDialog
                        isOpen={isConfirmDialogOpen}
                        onClose={() => setIsConfirmDialogOpen(false)}
                        onConfirm={(result) => {
                            if (confirmCallback.current) {
                                confirmCallback.current(result);
                                confirmCallback.current = null;
                            }
                        }}
                        message={confirmDialogMessage}
                    />
                </div>
            );
        };

        // Header Component
        const Header = () => {
            return (
                <header className="bg-gradient-to-r from-blue-700 to-blue-900 text-white py-4 px-6 shadow-xl rounded-b-2xl">
                    <div className="container mx-auto flex flex-col sm:flex-row justify-between items-center">
                        <h1 className="text-3xl font-extrabold mb-2 sm:mb-0 tracking-tight">室內設計財務 (Demo)</h1>
                        <div className="text-xs bg-blue-800 bg-opacity-70 px-3 py-1.5 rounded-full font-mono text-blue-100">
                            此為靜態展示版本，資料為虛擬數據。
                        </div>
                    </div>
                </header>
            );
        };

        // Main Content Component (handles routing between views)
        const MainContent = ({ showAlert, showConfirm }) => {
            const [currentPage, setCurrentPage] = React.useState('dashboard'); // 'dashboard', 'projects', 'projectDetail'
            const [selectedProjectId, setSelectedProjectId] = React.useState(null);

            const navigateToProjectDetail = (projectId) => {
                setSelectedProjectId(projectId);
                setCurrentPage('projectDetail');
            };

            const navigateToProjects = () => {
                setCurrentPage('projects');
                setSelectedProjectId(null);
            };

            let content;
            switch (currentPage) {
                case 'dashboard':
                    content = <Dashboard showAlert={showAlert} />;
                    break;
                case 'projects':
                    content = <ProjectList navigateToProjectDetail={navigateToProjectDetail} showAlert={showAlert} showConfirm={showConfirm} />;
                    break;
                case 'projectDetail':
                    content = <ProjectDetail projectId={selectedProjectId} navigateToProjects={navigateToProjects} showAlert={showAlert} showConfirm={showConfirm} />;
                    break;
                default:
                    content = <Dashboard showAlert={showAlert} />;
            }

            return (
                <main className="container mx-auto px-4 py-6 mt-4">
                    <NavBar currentPage={currentPage} setCurrentPage={setCurrentPage} />
                    {content}
                </main>
            );
        };

        // Navigation Bar Component
        const NavBar = ({ currentPage, setCurrentPage }) => {
            const navItemClass = "flex-1 text-center px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 cursor-pointer";
            const activeClass = "bg-blue-600 text-white shadow-md transform scale-105";
            const inactiveClass = "bg-white text-gray-700 hover:bg-blue-50 hover:text-blue-600";

            return (
                <nav className="bg-white p-2 rounded-xl shadow-lg mb-8 flex flex-wrap justify-center gap-2 sm:gap-4">
                    <button
                        onClick={() => setCurrentPage('dashboard')}
                        className={`${navItemClass} ${currentPage === 'dashboard' ? activeClass : inactiveClass}`}
                    >
                        儀表板
                    </button>
                    <button
                        onClick={() => setCurrentPage('projects')}
                        className={`${navItemClass} ${currentPage === 'projects' ? activeClass : inactiveClass}`}
                    >
                        專案列表
                    </button>
                </nav>
            );
        };

        // Dashboard Component
        const Dashboard = ({ showAlert }) => {
            const [timeRange, setTimeRange] = React.useState('year'); // 'month', 'quarter', 'year'

            // Data is static, no loading state needed
            const projects = staticProjects;
            const transactions = staticTransactions;

            // Filter transactions by selected time range
            const getFilteredTransactions = (txns) => {
                const now = new Date();
                let startDate = new Date();
                let endDate = new Date(now); // Clone now for endDate manipulation

                switch (timeRange) {
                    case 'month':
                        startDate.setMonth(now.getMonth(), 1); // First day of current month
                        break;
                    case 'quarter':
                        const currentMonth = now.getMonth();
                        const currentQuarterStartMonth = Math.floor(currentMonth / 3) * 3;
                        startDate.setMonth(currentQuarterStartMonth, 1);
                        break;
                    case 'year':
                        startDate.setFullYear(now.getFullYear(), 0, 1); // First day of current year
                        break;
                    default:
                        break;
                }
                startDate.setHours(0, 0, 0, 0); // Start of the day for startDate
                endDate.setHours(23, 59, 59, 999); // End of the day for endDate

                return txns.filter(txn => {
                    const txnDate = new Date(txn.date); // Assuming txn.date is in YYYY-MM-DD format
                    return txnDate >= startDate && txnDate <= endDate;
                });
            };

            const filteredTransactions = getFilteredTransactions(transactions);

            const totalIncome = filteredTransactions
                .filter(t => t.type === 'income')
                .reduce((sum, t) => sum + Math.round(t.amount || 0), 0);

            const totalExpense = filteredTransactions
                .filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + Math.round(t.amount || 0), 0);

            const netProfit = totalIncome - totalExpense;

            // Calculate project net profits for ranking
            const projectProfits = projects.map(project => {
                const projectIncome = transactions
                    .filter(t => t.projectId === project.id && t.type === 'income')
                    .reduce((sum, t) => sum + Math.round(t.amount || 0), 0);
                const projectExpense = transactions
                    .filter(t => t.projectId === project.id && t.type === 'expense')
                    .reduce((sum, t) => sum + Math.round(t.amount || 0), 0);
                return {
                    id: project.id,
                    name: project.projectName,
                    income: projectIncome,
                    expense: projectExpense,
                    netProfit: projectIncome - projectExpense,
                    startDate: project.startDate,
                    endDate: project.endDate
                };
            }).sort((a, b) => b.netProfit - a.netProfit); // Sort by net profit descending

            // Calculate expense category distribution for Pie Chart
            const expenseCategoryData = Object.keys(
                filteredTransactions
                    .filter(t => t.type === 'expense')
                    .reduce((acc, t) => {
                        acc[t.category] = (acc[t.category] || 0) + Math.round(t.amount || 0);
                        return acc;
                    }, {})
            ).map(category => ({
                name: category,
                value: filteredTransactions
                    .filter(t => t.type === 'expense' && t.category === category)
                    .reduce((sum, t) => sum + Math.round(t.amount || 0), 0)
            })).filter(data => data.value > 0); // Only include categories with actual expenses

            // Prepare data for Line Chart (monthly trends)
            const getMonthlyData = (txns) => {
                const monthlyDataMap = new Map(); // Key: YYYY-MM

                txns.forEach(txn => {
                    const date = new Date(txn.date);
                    const yearMonth = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}`;

                    if (!monthlyDataMap.has(yearMonth)) {
                        monthlyDataMap.set(yearMonth, { income: 0, expense: 0, netProfit: 0 });
                    }

                    const monthSummary = monthlyDataMap.get(yearMonth);
                    if (txn.type === 'income') {
                        monthSummary.income += Math.round(txn.amount || 0);
                    } else {
                        monthSummary.expense += Math.round(txn.amount || 0);
                    }
                    monthSummary.netProfit = monthSummary.income - monthSummary.expense;
                    monthlyDataMap.set(yearMonth, monthSummary);
                });

                // Convert map to array and sort by date
                const sortedData = Array.from(monthlyDataMap.entries())
                    .map(([date, data]) => ({ name: date, ...data }))
                    .sort((a, b) => new Date(a.name) - new Date(b.name));

                return sortedData;
            };

            const monthlyFinancialData = getMonthlyData(filteredTransactions);

            // Recharts components (imported via CDN)
            const { ResponsiveContainer, PieChart, Pie, Cell, Tooltip, Legend, LineChart, Line, XAxis, YAxis, CartesianGrid } = Recharts;

            return (
                <div className="bg-white p-6 rounded-xl shadow-lg">
                    <h2 className="text-2xl font-bold mb-6 text-center text-gray-800">儀表板總覽</h2>
                    {/* Time Range Selector */}
                    <div className="mb-8 flex justify-center gap-3">
                        <button
                            onClick={() => setTimeRange('month')}
                            className={`px-5 py-2 rounded-full text-sm font-medium transition-all duration-200 ${timeRange === 'month' ? 'bg-blue-600 text-white shadow-md' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`}
                        >
                            本月
                        </button>
                        <button
                            onClick={() => setTimeRange('quarter')}
                            className={`px-5 py-2 rounded-full text-sm font-medium transition-all duration-200 ${timeRange === 'quarter' ? 'bg-blue-600 text-white shadow-md' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`}
                        >
                            本季
                        </button>
                        <button
                            onClick={() => setTimeRange('year')}
                            className={`px-5 py-2 rounded-full text-sm font-medium transition-all duration-200 ${timeRange === 'year' ? 'bg-blue-600 text-white shadow-md' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`}
                        >
                            本年
                        </button>
                    </div>
                    {/* Overall Financial Summary */}
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
                        <div className="bg-green-50 p-5 rounded-xl shadow-sm text-center border border-green-200">
                            <h3 className="text-lg font-semibold text-green-700 mb-2">總收入</h3>
                            <p className="text-4xl font-extrabold text-green-800">NT$ {totalIncome.toLocaleString('zh-TW', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}</p>
                        </div>
                        <div className="bg-red-50 p-5 rounded-xl shadow-sm text-center border border-red-200">
                            <h3 className="text-lg font-semibold text-red-700 mb-2">總支出</h3>
                            <p className="text-4xl font-extrabold text-red-800">NT$ {totalExpense.toLocaleString('zh-TW', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}</p>
                        </div>
                        <div className={`p-5 rounded-xl shadow-sm text-center border ${netProfit >= 0 ? 'bg-blue-50 border-blue-200' : 'bg-orange-50 border-orange-200'}`}>
                            <h3 className="text-lg font-semibold ${netProfit >= 0 ? 'text-blue-700' : 'text-orange-700'} mb-2">淨利</h3>
                            <p className={`text-4xl font-extrabold ${netProfit >= 0 ? 'text-blue-800' : 'text-orange-800'}`}>NT$ {netProfit.toLocaleString('zh-TW', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}</p>
                        </div>
                    </div>
                    {/* Charts Section */}
                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-10">
                        <div className="bg-gray-50 p-5 rounded-xl shadow-inner border border-gray-100">
                            <h3 className="text-xl font-bold mb-4 text-gray-800 text-center">支出類別分佈</h3>
                            {expenseCategoryData.length > 0 ? (
                                <ResponsiveContainer width="100%" height={300}>
                                    <PieChart>
                                        <Pie
                                            data={expenseCategoryData}
                                            cx="50%"
                                            cy="50%"
                                            labelLine={false}
                                            outerRadius={100}
                                            fill="#8884d8"
                                            dataKey="value"
                                            label={({ name, percent }) => `${name} ${(percent * 100).toFixed(0)}%`}
                                        >
                                            {expenseCategoryData.map((entry, index) => (
                                                <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />
                                            ))}
                                        </Pie>
                                        <Tooltip formatter={(value) => `NT$ ${value.toLocaleString('zh-TW', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}`} />
                                        <Legend />
                                    </PieChart>
                                </ResponsiveContainer>
                            ) : (
                                <p className="text-center text-gray-600 py-4">尚無支出類別數據可供繪製圖表。</p>
                            )}
                        </div>
                        <div className="bg-gray-50 p-5 rounded-xl shadow-inner border border-gray-100">
                            <h3 className="text-xl font-bold mb-4 text-gray-800 text-center">財務趨勢 ({timeRange === 'month' ? '本月' : timeRange === 'quarter' ? '本季' : '本年'})</h3>
                            {monthlyFinancialData.length > 0 ? (
                                <ResponsiveContainer width="100%" height={300}>
                                    <LineChart
                                        data={monthlyFinancialData}
                                        margin={{ top: 5, right: 30, left: 20, bottom: 5 }}
                                    >
                                        <CartesianGrid strokeDasharray="3 3" stroke="#e0e0e0" />
                                        <XAxis dataKey="name" tickFormatter={(tick) => {
                                            const [year, month] = tick.split('-');
                                            return `${year}年${parseInt(month)}月`;
                                        }} />
                                        <YAxis tickFormatter={(value) => `NT$ ${value.toLocaleString('zh-TW', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}`} />
                                        <Tooltip formatter={(value) => `NT$ ${value.toLocaleString('zh-TW', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}`} labelFormatter={(label) => `${label}月`} />
                                        <Legend />
                                        <Line type="monotone" dataKey="income" stroke="#22c55e" activeDot={{ r: 8 }} name="收入" />
                                        <Line type="monotone" dataKey="expense" stroke="#ef4444" activeDot={{ r: 8 }} name="支出" />
                                        <Line type="monotone" dataKey="netProfit" stroke="#3b82f6" activeDot={{ r: 8 }} name="淨利" />
                                    </LineChart>
                                </ResponsiveContainer>
                            ) : (
                                <p className="text-center text-gray-600 py-4">尚無足夠交易數據可供繪製趨勢圖。</p>
                            )}
                        </div>
                    </div>
                    {/* Project Net Profit Ranking */}
                    <div className="mb-10">
                        <h3 className="text-xl font-bold mb-4 text-gray-800">專案淨利排名</h3>
                        {projectProfits.length > 0 ? (
                            <div className="overflow-x-auto rounded-lg shadow-sm border border-gray-100">
                                <table className="min-w-full bg-white">
                                    <thead className="bg-gray-50">
                                        <tr>
                                            <th className="py-3 px-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider rounded-tl-lg">專案名稱</th>
                                            <th className="py-3 px-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">開始日期</th>
                                            <th className="py-3 px-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">結束日期</th>
                                            <th className="py-3 px-4 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider">收入</th>
                                            <th className="py-3 px-4 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider">支出</th>
                                            <th className="py-3 px-4 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider rounded-tr-lg">淨利</th>
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y divide-gray-100">
                                        {projectProfits.map((project) => (
                                            <tr key={project.id} className="hover:bg-gray-50 transition-colors duration-150">
                                                <td className="py-3 px-4 text-sm font-medium text-gray-800">{project.name}</td>
                                                <td className="py-3 px-4 text-sm text-gray-600">{project.startDate || '未設定'}</td>
                                                <td className="py-3 px-4 text-sm text-gray-600">{project.endDate || '未設定'}</td>
                                                <td className="py-3 px-4 text-right text-sm text-gray-700">NT$ {project.income.toLocaleString('zh-TW', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}</td>
                                                <td className="py-3 px-4 text-right text-sm text-gray-700">NT$ {project.expense.toLocaleString('zh-TW', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}</td>
                                                <td className={`py-3 px-4 text-right text-sm font-semibold ${project.netProfit >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                                                    NT$ {project.netProfit.toLocaleString('zh-TW', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        ) : (
                            <p className="text-center text-gray-600 py-4">尚無專案數據。</p>
                        )}
                    </div>
                </div>
            );
        };

        // Project List Component
        const ProjectList = ({ navigateToProjectDetail, showAlert, showConfirm }) => {
            const projects = staticProjects; // Use static data
            const transactions = staticTransactions; // Use static data

            const [isAddModalOpen, setIsAddModalOpen] = React.useState(false);
            const [isEditModalOpen, setIsEditModalOpen] = React.useState(false);
            const [currentProjectToEdit, setCurrentProjectToEdit] = React.useState(null);

            // State for search and filter
            const [searchTerm, setSearchTerm] = React.useState('');
            const [filterStartDate, setFilterStartDate] = React.useState('');
            const [filterEndDate, setFilterEndDate] = React.useState('');

            // Filtered projects based on search term and date range
            const filteredProjects = projects.filter(project => {
                const matchesName = project.projectName.toLowerCase().includes(searchTerm.toLowerCase());

                const projectStartDate = project.startDate ? new Date(project.startDate) : null;
                const projectEndDate = project.endDate ? new Date(project.endDate) : null;

                const filterStart = filterStartDate ? new Date(filterStartDate) : null;
                const filterEnd = filterEndDate ? new Date(filterEndDate) : null;

                let matchesDate = true;
                if (filterStart) {
                    matchesDate = matchesDate && projectStartDate && projectStartDate >= filterStart;
                }
                if (filterEnd) {
                    const adjustedFilterEnd = new Date(filterEnd);
                    adjustedFilterEnd.setHours(23, 59, 59, 999);
                    matchesDate = matchesDate && projectEndDate && projectEndDate <= adjustedFilterEnd;
                }

                return matchesName && matchesDate;
            });

            // For static demo, these functions will just show an alert
            const handleAddProject = (e) => {
                e.preventDefault();
                showAlert("此為靜態展示版本，無法新增專案。");
            };

            const handleEditProject = (project) => {
                showAlert("此為靜態展示版本，無法編輯專案。");
            };

            const handleDeleteProject = async (projectId) => {
                showAlert("此為靜態展示版本，無法刪除專案。");
            };

            return (
                <div className="bg-white p-6 rounded-xl shadow-lg">
                    <h2 className="text-2xl font-bold mb-6 text-center text-gray-800">專案列表</h2>
                    <button
                        onClick={() => showAlert("此為靜態展示版本，無法新增專案。")}
                        className="bg-blue-600 text-white px-6 py-2.5 rounded-lg shadow-md hover:bg-blue-700 transition-all duration-200 transform hover:scale-105 mb-8 w-full sm:w-auto font-medium opacity-50 cursor-not-allowed"
                        disabled
                    >
                        新增專案 (Demo)
                    </button>
                    {/* Search and Filter Section */}
                    <div className="mb-8 p-4 bg-gray-50 rounded-lg shadow-inner border border-gray-100 grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
                        <div>
                            <label htmlFor="searchName" className="block text-gray-700 text-sm font-medium mb-2">搜尋專案名稱:</label>
                            <input
                                type="text"
                                id="searchName"
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"
                                placeholder="輸入專案名稱..."
                                value={searchTerm}
                                onChange={(e) => setSearchTerm(e.target.value)}
                            />
                        </div>
                        <div>
                            <label htmlFor="filterStartDate" className="block text-gray-700 text-sm font-medium mb-2">開始日期起:</label>
                            <input
                                type="date"
                                id="filterStartDate"
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"
                                value={filterStartDate}
                                onChange={(e) => setFilterStartDate(e.target.value)}
                            />
                        </div>
                        <div>
                            <label htmlFor="filterEndDate" className="block text-gray-700 text-sm font-medium mb-2">結束日期迄:</label>
                            <input
                                type="date"
                                id="filterEndDate"
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"
                                value={filterEndDate}
                                onChange={(e) => setFilterEndDate(e.target.value)}
                            />
                        </div>
                    </div>
                    {/* Modals for add/edit are kept but disabled */}
                    <Modal isOpen={isAddModalOpen} onClose={() => setIsAddModalOpen(false)} title="新增專案">
                        <p className="text-red-600 mb-4">此為靜態展示版本，無法新增專案。</p>
                        {/* Form elements would be here, but they are effectively disabled */}
                        <div className="flex justify-end gap-3">
                            <button
                                type="button"
                                onClick={() => setIsAddModalOpen(false)}
                                className="bg-gray-300 text-gray-800 px-5 py-2 rounded-lg hover:bg-gray-400 transition-colors transform hover:scale-105"
                            >
                                取消
                            </button>
                            <button
                                type="submit"
                                className="bg-blue-600 text-white px-5 py-2 rounded-lg shadow-md opacity-50 cursor-not-allowed"
                                disabled
                            >
                                新增
                            </button>
                        </div>
                    </Modal>
                    {currentProjectToEdit && (
                        <Modal isOpen={isEditModalOpen} onClose={() => setIsEditModalOpen(false)} title="編輯專案">
                            <p className="text-red-600 mb-4">此為靜態展示版本，無法編輯專案。</p>
                            {/* Form elements would be here, but they are effectively disabled */}
                            <div className="flex justify-end gap-3">
                                <button
                                    type="button"
                                    onClick={() => setIsEditModalOpen(false)}
                                    className="bg-gray-300 text-gray-800 px-5 py-2 rounded-lg hover:bg-gray-400 transition-colors transform hover:scale-105"
                                >
                                    取消
                                </button>
                                <button
                                    type="submit"
                                    className="bg-blue-600 text-white px-5 py-2 rounded-lg shadow-md opacity-50 cursor-not-allowed"
                                    disabled
                                >
                                    更新
                                </button>
                            </div>
                        </Modal>
                    )}
                    {filteredProjects.length === 0 ? (
                        <p className="text-center text-gray-600 py-8">目前沒有符合篩選條件的專案。</p>
                    ) : (
                        <div className="overflow-x-auto rounded-lg shadow-sm border border-gray-100">
                            <table className="min-w-full bg-white">
                                <thead className="bg-gray-50">
                                    <tr>
                                        <th className="py-3 px-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider rounded-tl-lg">專案名稱</th>
                                        <th className="py-3 px-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">客戶名稱</th>
                                        <th className="py-3 px-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">狀態</th>
                                        <th className="py-3 px-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">開始日期</th>
                                        <th className="py-3 px-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">結束日期</th>
                                        <th className="py-3 px-4 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider">預估收入</th>
                                        <th className="py-3 px-4 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider">實際收入</th>
                                        <th className="py-3 px-4 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider">實際支出</th>
                                        <th className="py-3 px-4 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider">實際淨利</th>
                                        <th className="py-3 px-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider rounded-tr-lg">操作</th>
                                    </tr>
                                </thead>
                                <tbody className="divide-y divide-gray-100">
                                    {filteredProjects.map((project) => (
                                        <tr key={project.id} className="hover:bg-gray-50 transition-colors duration-150">
                                            <td className="py-3 px-4 text-sm font-medium text-gray-800">{project.projectName}</td>
                                            <td className="py-3 px-4 text-sm text-gray-600">{project.clientName}</td>
                                            <td className="py-3 px-4">
                                                <span className={`px-2 py-0.5 text-xs font-semibold rounded-full ${
                                                    project.status === '已結案' ? 'bg-green-100 text-green-800' :
                                                    project.status === '施工中' ? 'bg-blue-100 text-blue-800' :
                                                    'bg-gray-100 text-gray-800'
                                                }`}>
                                                    {project.status}
                                                </span>
                                            </td>
                                            <td className="py-3 px-4 text-sm text-gray-600">{project.startDate || '未設定'}</td>
                                            <td className="py-3 px-4 text-sm text-gray-600">{project.endDate || '未設定'}</td>
                                            <td className="py-3 px-4 text-right text-sm text-gray-700">NT$ {Math.round(parseFloat(project.estimatedRevenue || 0)).toLocaleString('zh-TW', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}</td>
                                            <td className="py-3 px-4 text-right text-sm text-gray-700">NT$ {Math.round(parseFloat(project.actualRevenue || 0)).toLocaleString('zh-TW', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}</td>
                                            <td className="py-3 px-4 text-right text-sm text-gray-700">NT$ {Math.round(parseFloat(project.actualExpense || 0)).toLocaleString('zh-TW', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}</td>
                                            <td className={`py-3 px-4 text-right text-sm font-semibold ${project.actualNetProfit >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                                                NT$ {project.actualNetProfit.toLocaleString('zh-TW', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}
                                            </td>
                                            <td className="py-3 px-4 flex gap-2">
                                                <button
                                                    onClick={() => navigateToProjectDetail(project.id)}
                                                    className="bg-indigo-500 text-white px-3.5 py-1.5 rounded-md text-sm hover:bg-indigo-600 transition-colors transform hover:scale-105"
                                                >
                                                    查看
                                                </button>
                                                <button
                                                    onClick={() => handleEditProject(project)}
                                                    className="bg-yellow-500 text-white px-3.5 py-1.5 rounded-md text-sm opacity-50 cursor-not-allowed"
                                                    disabled
                                                >
                                                    編輯
                                                </button>
                                                <button
                                                    onClick={() => handleDeleteProject(project.id)}
                                                    className="bg-red-500 text-white px-3.5 py-1.5 rounded-md text-sm opacity-50 cursor-not-allowed"
                                                    disabled
                                                >
                                                    刪除
                                                </button>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    )}
                </div>
            );
        };

        // Project Detail Component
        const ProjectDetail = ({ projectId, navigateToProjects, showAlert, showConfirm }) => {
            // Find the project and its transactions from static data
            const project = staticProjects.find(p => p.id === projectId);
            const transactions = staticTransactions.filter(t => t.projectId === projectId);

            // Sort transactions by date descending
            transactions.sort((a, b) => new Date(b.date) - new Date(a.date));

            const [isAddTransactionModalOpen, setIsAddTransactionModalOpen] = React.useState(false);
            const [isEditTransactionModalOpen, setIsEditTransactionModalOpen] = React.useState(false);
            const [currentTransactionToEdit, setCurrentTransactionToEdit] = React.useState(null);

            const [isEditProjectModalOpen, setIsEditProjectModalOpen] = React.useState(false);
            const [editedProjectName, setEditedProjectName] = React.useState(project?.projectName || '');
            const [editedClientName, setEditedClientName] = React.useState(project?.clientName || '');
            const [editedEstimatedRevenue, setEditedEstimatedRevenue] = React.useState(project?.estimatedRevenue || '');
            const [editedStatus, setEditedStatus] = React.useState(project?.status || '');
            const [editedStartDate, setEditedStartDate] = React.useState(project?.startDate || '');
            const [editedEndDate, setEditedEndDate] = React.useState(project?.endDate || '');

            React.useEffect(() => {
                // If project is not found, navigate back to project list
                if (!project) {
                    showAlert("找不到此專案或已刪除。將返回專案列表。");
                    navigateToProjects();
                }
            }, [project, showAlert, navigateToProjects]);

            // For static demo, these functions will just show an alert
            const handleAddTransaction = (e) => {
                e.preventDefault();
                showAlert("此為靜態展示版本，無法新增交易。");
            };

            const handleDeleteTransaction = async (transactionId) => {
                showAlert("此為靜態展示版本，無法刪除交易。");
            };

            const handleEditTransaction = (transaction) => {
                showAlert("此為靜態展示版本，無法編輯交易。");
            };

            const handleUpdateTransaction = async (e) => {
                e.preventDefault();
                showAlert("此為靜態展示版本，無法更新交易。");
            };

            const handleUpdateProject = async (e) => {
                e.preventDefault();
                showAlert("此為靜態展示版本，無法更新專案資訊。");
            };

            if (!project) {
                return <div className="text-center p-6 text-red-600">載入專案詳細資料中...</div>; // Or a loading spinner
            }

            const totalIncome = transactions
                .filter(t => t.type === 'income')
                .reduce((sum, t) => sum + Math.round(t.amount || 0), 0);

            const totalExpense = transactions
                .filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + Math.round(t.amount || 0), 0);

            const netProfit = totalIncome - totalExpense;
            const grossMargin = totalIncome > 0 ? (netProfit / totalIncome * 100).toFixed(0) : 0;

            return (
                <div className="bg-white p-6 rounded-xl shadow-lg">
                    <button
                        onClick={navigateToProjects}
                        className="mb-6 inline-flex items-center bg-gray-100 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-200 transition-colors transform hover:scale-105 text-sm font-medium"
                    >
                        <svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2">
                            <path strokeLinecap="round" strokeLinejoin="round" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                        </svg>
                        返回專案列表
                    </button>
                    <h2 className="text-3xl font-bold mb-4 text-center text-blue-700">{project.projectName}</h2>
                    <div className="text-center text-gray-600 mb-8 p-4 bg-gray-50 rounded-lg border border-gray-100 shadow-sm">
                        <p className="mb-1 text-lg">客戶名稱: <span className="font-semibold text-gray-800">{project.clientName}</span></p>
                        <p className="mb-1 text-lg">狀態: <span className={`font-semibold ${
                            project.status === '已結案' ? 'text-green-600' :
                            project.status === '施工中' ? 'text-blue-600' :
                            'text-gray-600'
                        }`}>{project.status}</span></p>
                        <p className="mb-1 text-lg">預估收入: <span className="font-semibold text-gray-800">NT$ {Math.round(parseFloat(project.estimatedRevenue || 0)).toLocaleString('zh-TW', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}</span></p>
                        <p className="mb-1 text-lg">開始日期: <span className="font-semibold text-gray-800">{project.startDate || '未設定'}</span></p>
                        <p className="mb-4 text-lg">結束日期: <span className="font-semibold text-gray-800">{project.endDate || '未設定'}</span></p>
                        <button
                            onClick={() => showAlert("此為靜態展示版本，無法編輯專案資訊。")}
                            className="bg-indigo-500 text-white px-4 py-2 rounded-lg text-sm opacity-50 cursor-not-allowed font-medium shadow-sm"
                            disabled
                        >
                            編輯專案資訊 (Demo)
                        </button>
                    </div>
                    {/* Modal for editing project details - kept but disabled */}
                    <Modal isOpen={isEditProjectModalOpen} onClose={() => setIsEditProjectModalOpen(false)} title="編輯專案">
                        <p className="text-red-600 mb-4">此為靜態展示版本，無法編輯專案。</p>
                        {/* Form elements would be here, but they are effectively disabled */}
                        <div className="flex justify-end gap-3">
                            <button
                                type="button"
                                onClick={() => setIsEditProjectModalOpen(false)}
                                className="bg-gray-300 text-gray-800 px-5 py-2 rounded-lg hover:bg-gray-400 transition-colors transform hover:scale-105"
                            >
                                取消
                            </button>
                            <button
                                type="submit"
                                className="bg-blue-600 text-white px-5 py-2 rounded-lg shadow-md opacity-50 cursor-not-allowed"
                                disabled
                            >
                                更新
                            </button>
                        </div>
                    </Modal>

                    {/* Project Financial Summary */}
                    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mb-10">
                        <div className="bg-green-50 p-5 rounded-xl shadow-sm text-center border border-green-200">
                            <h3 className="text-lg font-semibold text-green-700 mb-2">實際收入</h3>
                            <p className="text-4xl font-extrabold text-green-800">NT$ {totalIncome.toLocaleString('zh-TW', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}</p>
                        </div>
                        <div className="bg-red-50 p-5 rounded-xl shadow-sm text-center border border-red-200">
                            <h3 className="text-lg font-semibold text-red-700 mb-2">實際支出</h3>
                            <p className="text-4xl font-extrabold text-red-800">NT$ {totalExpense.toLocaleString('zh-TW', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}</p>
                        </div>
                        <div className={`p-5 rounded-xl shadow-sm text-center border ${netProfit >= 0 ? 'bg-blue-50 border-blue-200' : 'bg-orange-50 border-orange-200'}`}>
                            <h3 className="text-lg font-semibold ${netProfit >= 0 ? 'text-blue-700' : 'text-orange-700'} mb-2">淨利</h3>
                            <p className={`text-4xl font-extrabold ${netProfit >= 0 ? 'text-blue-800' : 'text-orange-800'}`}>NT$ {netProfit.toLocaleString('zh-TW', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}</p>
                            <p className="text-sm text-gray-600 mt-2">毛利率: {grossMargin}%</p>
                        </div>
                    </div>
                    {/* Add Transaction Button */}
                    <button
                        onClick={() => showAlert("此為靜態展示版本，無法新增收入/支出。")}
                        className="bg-blue-600 text-white px-6 py-2.5 rounded-lg shadow-md hover:bg-blue-700 transition-all duration-200 transform hover:scale-105 mb-8 w-full sm:w-auto font-medium opacity-50 cursor-not-allowed"
                        disabled
                    >
                        新增收入/支出 (Demo)
                    </button>
                    {/* Modals for add/edit transactions are kept but disabled */}
                    <Modal isOpen={isAddTransactionModalOpen} onClose={() => setIsAddTransactionModalOpen(false)} title="新增交易">
                        <p className="text-red-600 mb-4">此為靜態展示版本，無法新增交易。</p>
                        {/* Form elements would be here, but they are effectively disabled */}
                        <div className="flex justify-end gap-3">
                            <button
                                type="button"
                                onClick={() => setIsAddTransactionModalOpen(false)}
                                className="bg-gray-300 text-gray-800 px-5 py-2 rounded-lg hover:bg-gray-400 transition-colors transform hover:scale-105"
                            >
                                取消
                            </button>
                            <button
                                type="submit"
                                className="bg-blue-600 text-white px-5 py-2 rounded-lg shadow-md opacity-50 cursor-not-allowed"
                                disabled
                            >
                                新增
                            </button>
                        </div>
                    </Modal>
                    {currentTransactionToEdit && (
                        <Modal isOpen={isEditTransactionModalOpen} onClose={() => setIsEditTransactionModalOpen(false)} title="編輯交易">
                            <p className="text-red-600 mb-4">此為靜態展示版本，無法編輯交易。</p>
                            {/* Form elements would be here, but they are effectively disabled */}
                            <div className="flex justify-end gap-3">
                                <button
                                    type="button"
                                    onClick={() => setIsEditTransactionModalOpen(false)}
                                    className="bg-gray-300 text-gray-800 px-5 py-2 rounded-lg hover:bg-gray-400 transition-colors transform hover:scale-105"
                                >
                                    取消
                                </button>
                                <button
                                    type="submit"
                                    className="bg-blue-600 text-white px-5 py-2 rounded-lg shadow-md opacity-50 cursor-not-allowed"
                                    disabled
                                >
                                    更新
                                </button>
                            </div>
                        </Modal>
                    )}
                    {/* Transactions List */}
                    <h3 className="text-xl font-bold mb-4 text-gray-800">交易明細</h3>
                    {transactions.length === 0 ? (
                        <p className="text-center text-gray-600 py-8">目前沒有交易記錄。</p>
                    ) : (
                        <div className="overflow-x-auto rounded-lg shadow-sm border border-gray-100">
                            <table className="min-w-full bg-white">
                                <thead className="bg-gray-50">
                                    <tr>
                                        <th className="py-3 px-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider rounded-tl-lg">日期</th>
                                        <th className="py-3 px-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">類型</th>
                                        <th className="py-3 px-4 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider">金額 (NT$)</th>
                                        <th className="py-3 px-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">類別</th>
                                        <th className="py-3 px-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">發票/收據號碼</th>
                                        <th className="py-3 px-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">備註</th>
                                        <th className="py-3 px-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider rounded-tr-lg">操作</th>
                                    </tr>
                                </thead>
                                <tbody className="divide-y divide-gray-100">
                                    {transactions.map((txn) => (
                                        <tr key={txn.id} className="hover:bg-gray-50 transition-colors duration-150">
                                            <td className="py-3 px-4 text-sm text-gray-700">{txn.date}</td>
                                            <td className="py-3 px-4 text-sm font-semibold ${txn.type === 'income' ? 'text-green-600' : 'text-red-600'}">
                                                {txn.type === 'income' ? '收入' : '支出'}
                                            </td>
                                            <td className="py-3 px-4 text-right text-sm text-gray-700">{Math.round(parseFloat(txn.amount || 0)).toLocaleString('zh-TW', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}</td>
                                            <td className="py-3 px-4 text-sm text-gray-700">{txn.category}</td>
                                            <td className="py-3 px-4 text-sm text-gray-700">{txn.invoiceNumber || '無'}</td>
                                            <td className="py-3 px-4 text-sm text-gray-600 max-w-[150px] truncate">{txn.description || '無'}</td>
                                            <td className="py-3 px-4 flex gap-2">
                                                <button
                                                    onClick={() => handleEditTransaction(txn)}
                                                    className="bg-yellow-500 text-white px-3.5 py-1.5 rounded-md text-sm opacity-50 cursor-not-allowed"
                                                    disabled
                                                >
                                                    編輯
                                                </button>
                                                <button
                                                    onClick={() => handleDeleteTransaction(txn.id)}
                                                    className="bg-red-500 text-white px-3.5 py-1.5 rounded-md text-sm opacity-50 cursor-not-allowed"
                                                    disabled
                                                >
                                                    刪除
                                                </button>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    )}
                </div>
            );
        };

        // Render the main App component into the 'root' div
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
